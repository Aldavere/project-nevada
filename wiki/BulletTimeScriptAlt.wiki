#Bullet Time Script
{{{
ScriptName PNxFPSBulletTimeScript


;Global PNxFPSBulletTimeON
;Global PNxFPSBulletTimeActive
;Global PNxFPSBulletTimeKey

float timer
float apDamagePeriod

int apRegen
short vfx
short toggle
short suspendInMenu

;Begin OnAdd Player

;initial values
;       set apDamagePeriod to 0.50
;       set timeFactor to 0.50
;       set apDamage to -16
;       set vfx to 0
;       
;End


Begin OnDeath Player
        ; on player death make sure ap is restored and
        ; time is back to normal
        sgtm 1
        set PNxFPSBulletTimeON to 0
End

Begin Menumode
   if (PNxFPSBulletTimeActive == 1 && suspendInMenu != 1)
        set suspendInMenu to 1
        set PNxFPSBulletTimeActive to 0

        if (vfx== 0)
            rimod MS10DrinkSap02ISFX
        elseif (vfx== 1)
            rimod TranquilityLaneISFX
        elseif (vfx== 2)
            rimod DKBlue
        endif
        sgtm 1
    endif
Endf

Begin GameMode

        ; Store key in questvar for conflict detection
        if (PNxFPSBulletTimeKey > 0)

                ; listening for keyup
                if(iskeypressed PNxFPSBulletTimeKey != toggle)
                        set toggle to iskeypressed PNxFPSBulletTimeKey 
                                
                        if(toggle)
                                ;key just pressed - do nothing
                        else 
                                if (PNxFPSBulletTimeON == 0)
                                        set PNxFPSBulletTimeON to 1
                                else
                                        set PNxFPSBulletTimeON to 0
                                endif
                        endif
                endif
        endif

        if (PNxFPSBulletTimeON == 1 && PNxFPSBulletTimeActive == 0)     
                if (suspendInMenu == 1)
                        set suspendInMenu to 0
                else
                        playsound UIVATSCameraIn
                        TriggerHitShader 0.5
                        set apRegen to GetGameSetting fActionPointsRestoreRate
            con_SetGameSetting fActionPointsRestoreRate, 0

                        endif

                endif

                set PNxFPSBulletTimeActive to 1
                sgtm timeFactor
                set timer to 0

                if (vfx== 0)
                        imod MS10DrinkSap02ISFX, 0.5
                elseif (vfx== 1)
                        imod TranquilityLaneISFX, 0.4
                elseif (vfx== 2)
                        imod DKBlue, 0.5
                endif

        endIf

        if (PNxFPSBulletTimeActive == 1)
                if (timer >= apDamagePeriod)
                        set timer to 0
                        player.damageav ActionPoints, apDamage
                else
                        set timer to timer + GetSecondsPassed
                endif

                ; end bullet time if AP has reached 0
                if (player.getav ActionPoints <= 0)
                        set PNxFPSBulletTimeON to 0
                endif

                ; turn off BT if PNxFPSBulletTimeON is 0
                if (PNxFPSBulletTimeON == 0) 
                        set PNxFPSBulletTimeActive to 0
                        sgtm 1

                        ; FX, sound and shader
                        playsound UIVATSCameraOut
                        TriggerHitShader 0.75
                        con_SetGameSetting fActionPointsRestoreRate, apregen
                        
                        ; turn off the appropriate effect
                        if (vfx == 0)
                                rimod MS10DrinkSap02ISFX
                        elseif (vfx == 1)
                                rimod TranquilityLaneISFX
                        elseif (vfx == 2)
                                rimod DKBlue
                        endif

                endIf
        endIf
End
}}}